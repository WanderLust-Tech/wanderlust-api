<?xml version="1.0" encoding="utf-8"?>
<!--
Linux Server Publishing Profile - Framework-dependent deployment for Linux
Smaller deployment size, requires .NET runtime on target server
-->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <WebPublishMethod>FileSystem</WebPublishMethod>
    <LastUsedBuildConfiguration>Release</LastUsedBuildConfiguration>
    <LastUsedPlatform>Any CPU</LastUsedPlatform>
    <SiteUrlToLaunchAfterPublish />
    <LaunchSiteAfterPublish>False</LaunchSiteAfterPublish>
    <ExcludeApp_Data>False</ExcludeApp_Data>
    <ProjectGuid>$(ProjectGuid)</ProjectGuid>
    <PublishUrl>bin\Release\net8.0\linux-x64\publish-fdd</PublishUrl>
    <DeleteExistingFiles>True</DeleteExistingFiles>
    <TargetFramework>net8.0</TargetFramework>
    <RuntimeIdentifier>linux-x64</RuntimeIdentifier>
    <SelfContained>false</SelfContained>
    <PublishSingleFile>false</PublishSingleFile>
    <PublishReadyToRun>true</PublishReadyToRun>
    <PublishTrimmed>false</PublishTrimmed>
    <EnvironmentName>Production</EnvironmentName>
    <PublishProfile>Linux-Server-FDD</PublishProfile>
  </PropertyGroup>
  
  <!-- Framework-dependent deployment settings -->
  <PropertyGroup>
    <PublishWithAspNetCoreTargetManifest>false</PublishWithAspNetCoreTargetManifest>
    <UseAppHost>true</UseAppHost>
  </PropertyGroup>
  
  <!-- Exclude Windows-specific and development files -->
  <ItemGroup>
    <Content Remove="appsettings.Development.json" />
    <Content Remove="**/*.pdb" />
    <Content Remove="**/*.xml" />
    <Content Remove="web.config" />
  </ItemGroup>
  
  <!-- Create Linux deployment info -->
  <Target Name="CreateLinuxDeploymentInfo" AfterTargets="PublishFiles">
    <PropertyGroup>
      <DeploymentInfoContent>Linux Framework-Dependent Deployment
Requires .NET 8 Runtime on target server
Runtime: linux-x64
Self-contained: false
Deployment created: $([System.DateTime]::Now)
Configuration: $(Configuration)

Prerequisites on Linux server:
  wget https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
  sudo dpkg -i packages-microsoft-prod.deb
  sudo apt-get update
  sudo apt-get install -y aspnetcore-runtime-8.0

To run:
  dotnet WanderlustApi.dll

With environment variables:
  export ASPNETCORE_ENVIRONMENT=Production
  export ASPNETCORE_URLS=http://+:5000
  dotnet WanderlustApi.dll</DeploymentInfoContent>
    </PropertyGroup>
    <WriteLinesToFile File="$(PublishUrl)\deployment-info.txt" Lines="$(DeploymentInfoContent)" Overwrite="true" />
    <Message Text="âœ… Linux FDD deployment package created at: $(PublishUrl)" Importance="high" />
    <Message Text="ðŸ“‹ See deployment-info.txt for runtime installation and setup" Importance="high" />
  </Target>
</Project>
