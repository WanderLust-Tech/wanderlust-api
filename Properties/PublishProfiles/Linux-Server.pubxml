<?xml version="1.0" encoding="utf-8"?>
<!--
Linux Server Publishing Profile - Self-contained deployment for Linux
-->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <WebPublishMethod>FileSystem</WebPublishMethod>
    <LastUsedBuildConfiguration>Release</LastUsedBuildConfiguration>
    <LastUsedPlatform>Any CPU</LastUsedPlatform>
    <SiteUrlToLaunchAfterPublish />
    <LaunchSiteAfterPublish>False</LaunchSiteAfterPublish>
    <ExcludeApp_Data>False</ExcludeApp_Data>
    <ProjectGuid>$(ProjectGuid)</ProjectGuid>
    <PublishUrl>bin\Release\net8.0\linux-x64\publish</PublishUrl>
    <DeleteExistingFiles>True</DeleteExistingFiles>
    <TargetFramework>net8.0</TargetFramework>
    <RuntimeIdentifier>linux-x64</RuntimeIdentifier>
    <SelfContained>true</SelfContained>
    <PublishSingleFile>false</PublishSingleFile>
    <PublishReadyToRun>true</PublishReadyToRun>
    <PublishTrimmed>false</PublishTrimmed>
    <EnvironmentName>Production</EnvironmentName>
    <PublishProfile>Linux-Server</PublishProfile>
  </PropertyGroup>
  
  <!-- Linux-specific optimizations -->
  <PropertyGroup>
    <PublishWithAspNetCoreTargetManifest>false</PublishWithAspNetCoreTargetManifest>
    <UseAppHost>true</UseAppHost>
    <EnableCompressionInSingleFile>true</EnableCompressionInSingleFile>
  </PropertyGroup>
  
  <!-- Exclude Windows-specific files -->
  <ItemGroup>
    <Content Remove="appsettings.Development.json" />
    <Content Remove="**/*.pdb" />
    <Content Remove="**/*.xml" />
    <Content Remove="web.config" />
  </ItemGroup>
  
  <!-- Include Linux service files -->
  <Target Name="CreateLinuxServiceFiles" AfterTargets="PublishFiles">
    <PropertyGroup>
      <ServiceInfoContent>Service Name: wanderlust-api
Runtime: linux-x64
Self-contained: true
Deployment created: $([System.DateTime]::Now)
Configuration: $(Configuration)
Target Framework: $(TargetFramework)

To run on Linux:
  chmod +x WanderlustApi
  ./WanderlustApi

Or with custom settings:
  export ASPNETCORE_ENVIRONMENT=Production
  export ASPNETCORE_URLS=http://+:5000
  ./WanderlustApi</ServiceInfoContent>
    </PropertyGroup>
    <WriteLinesToFile File="$(PublishUrl)\deployment-info.txt" Lines="$(ServiceInfoContent)" Overwrite="true" />
    <Message Text="âœ… Linux deployment package created at: $(PublishUrl)" Importance="high" />
    <Message Text="ðŸ“‹ See deployment-info.txt for setup instructions" Importance="high" />
  </Target>
</Project>
